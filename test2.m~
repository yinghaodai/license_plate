function plate = test2(image)
%image = imread('test1.png');
%Threshold to colour license plate, crop out located and straightened license plate
threshim = thresholdimage2(image);
cropped = crop(threshim,image,50);
threshcropped = logical(erosion(((cropped(:,:,3) < cropped(:,:,2) - 15) & (cropped(:,:,2) > 85)),3));
straightplate = rotateplate2(threshcropped);
croppedplate = crop(straightplate,straightplate,0);

labeled = label(brmedgeobjs(~closing(croppedplate,5),1));
if sum(sum(logical(labeled))) < 300
    plate = '';
else
    sizes = measure(labeled,[],'size');
    if length([sizes.size]) < 6
        plate = '';
    else
        sorted = sort([sizes.size],'descend');
        smallest = sorted(6);
        a = labeled & 0;
        for i=1:length(sorted)
            if sizes.size(i) >= smallest
                a = a | labeled == i;
            end
        end
        xmin = zeros(1,6);
        xmax = zeros(1,6);
        ymin = zeros(1,6);
        ymax = zeros(1,6);
        lettermin = measure(a,[],'Minimum');
        lettermax = measure(a,[],'Maximum');
        for i = 1:6
            xmin(i) = lettermin.Minimum(2*i - 1);
            ymin(i) = lettermin.Minimum(2*i);
            xmax(i) = lettermax.Maximum(2*i - 1);
            ymax(i) = lettermax.Maximum(2*i);
        end
        startpo = sort(xmin,'ascend');
        plate = zeros(1, 6);
         for i = 1:6
             index = find(xmin == sorted2(i));
             character = ~imcrop(logical(a),[xmin(index) ymin(index) xmax(index)-xmin(index) ymax(index)-ymin(index)]);
             plate(1, i) = recognize(character);
         end
         plate = char(plate);
    end
end
end
